var Card,Game,Hand,Bet,barContainer,cardValue,controlsContainer,dealerContainer,dealerHand,hiddenCard,playerContainer,playerHand,suits,dealerSpeed,userMoney,currentBet,minimumBet,winSound;suits=["club","diamond","heart","spade"],cardValue=["a",2,3,4,5,6,7,8,9,10,"j","q","k"],playerContainer="#player",dealerContainer="#dealer",controlsContainer="#controls",barContainer="#msg",minimumBet=100,dealerSpeed=350,userMoney=1100,currentBet=minimumBet,winSound=".audio .win",Game={deal:function(){var a,b;return b=Math.floor(Math.random()*suits.length),a=Math.floor(Math.random()*cardValue.length),new Card(b,a)},hitUser:function(a){var b,c,d;if("player"===a)b=playerHand.hitMe(),d=playerContainer;else{if("dealer"!==a)throw"hitUser function needs a role";b=dealerHand.hitMe(),d=dealerContainer}c=b.getCard(),$(c).appendTo(d).addClass("placed")},createHand:function(a){var b,c,d,e,f,g,h;if(c=new Hand,e=c.getHand(),f=null,"player"===a)f=playerContainer;else{if("dealer"!==a)throw"createHand function needs a role";f=dealerContainer}for(g=0,h=e.length;h>g;g++)b=e[g],d=e[g].getCard(),"dealer"===a&&0===g?(d=e[g].getCard("hidden"),hiddenCard=e[g].getCard()):d=e[g].getCard(),$(f).append(d),Game.sounds.deal();return"player"===a&&c.score()<21&&Game.helpers.updateBar("Your hand is "+c.score()+", press Hit or Stand",3*dealerSpeed),c},winActions:function(){userMoney+=currentBet,currentBet=minimumBet,Game.updateMoney(),Game.sounds.win()},tieActions:function(){userMoney+=currentBet/2,currentBet=minimumBet,Game.updateMoney()},looseActions:function(){userMoney-=currentBet,currentBet=minimumBet,Game.updateMoney(),Game.sounds.loose()},sounds:{stop:function(){$(".sounds").find("audio").each(function(){var a=$(this).get(0);a.pause(),a.currentTime=0})},win:function(){this.stop(),$(".sounds").find(".win").get(0).play()},loose:function(){this.stop(),$(".sounds").find(".loose").get(0).play()},tie:function(){this.stop(),$(".sounds").find(".tie").get(0).play()},deal:function(){this.stop()},bet:function(){$(".sounds").find(".bet").get(0).play()}},updateMoney:function(){0>userMoney&&(userMoney=0),currentBet>minimumBet?$("#statusbar #reduce").removeClass("dis"):(currentBet=minimumBet,$("#statusbar #reduce").addClass("dis")),minimumBet>userMoney?$("#statusbar #raise").addClass("dis"):$("#statusbar #raise").removeClass("dis"),$("#current-bet").text(currentBet),$("#user-money").text(userMoney)},declareWinner:function(a){var b,c,d;return d="You got "+a.score(),b="dealer got "+dealerHand.score(),c=d+", "+b,21===a.score()?(Game.winActions(),d+"! Blackjack!"):a.score()>21?dealerHand.score()>21?(Game.tieActions(),c+". You tied!"):(Game.looseActions(),c+". You lose!"):dealerHand.score()>21?(Game.winActions(),c+". You win!"):a.score()>dealerHand.score()?(Game.winActions(),c+". You win!"):a.score()===dealerHand.score()?(Game.tieActions(),c+". You tied!"):(Game.looseActions(),c+"! You lose!")},helpers:{dealAnimate:function(){$(".hand").each(function(){var a,b,c,d;a=0,c=$(this),b=c.find(".card"),d=setInterval(function(){$(b[a]).addClass("placed"),a===b.length&&clearInterval(this),a++},dealerSpeed)})},updateBar:function(a,b){$(barContainer).text("Dealing ...").addClass("dealing"),Game.helpers.stopControls(),setTimeout(function(){$(barContainer).text(a).removeClass("dealing"),$("#restart").is(":visible")||Game.helpers.initControls()},b||dealerSpeed)},stopControls:function(){$(controlsContainer).find("#hit, #stand").addClass("dis")},initControls:function(){$(controlsContainer).find("#hit, #stand").removeClass("dis")}},play:{finish:function(){var a=$(hiddenCard).attr("class"),b=$(hiddenCard).attr("data-number");Game.helpers.stopControls(),$(dealerContainer).find(".card:first-child").attr("class",a).attr("data-number",b).append('<div class="cover"></div><div class="deck"></div>').addClass("rolled"),Game.helpers.updateBar(Game.declareWinner(playerHand,dealerHand)),$(controlsContainer).find("#restart").show()},evaluate:function(){playerHand.score()>=21?Game.play.finish():playerHand.score()<21?(Game.hitUser("player"),dealerHand.score()<17&&(Game.hitUser("dealer"),dealerHand.score()>=21&&Game.play.finish()),playerHand.score()>=21||dealerHand.score()>=21?Game.play.finish():Game.helpers.updateBar("Your hand is "+playerHand.score()+", press Hit or Stand")):Game.play.finish()}},startScreen:function(){$("#cover").css("visibility","visible"),$("#logo").transition({x:"-50em"},0).transition({x:"0"},600,"in-out"),$("#new-game").transition({x:"-50em"},0),$("#new-game").transition({x:"0"},600,"in-out"),$("#logo").transition({perspective:"439px",rotateY:"0deg"}).transition({perspective:"439px",rotateY:"360deg"},600)},startNew:function(){playerHand=Game.createHand("player"),dealerHand=Game.createHand("dealer"),Game.helpers.dealAnimate(),playerHand.score()>=21&&Game.play.finish()},init:function(){Game.startScreen(),Game.updateMoney(),$("#new-game").on("click",function(){return $(".webfont-preload").remove(),Game.startNew(),$("#cover").hide(),$("#game").css("visibility","visible"),!1}),$("#statusbar").on("click","#raise:not(.dis)",function(){return currentBet+=minimumBet,userMoney-=minimumBet,Game.sounds.bet(),Game.updateMoney(),!1}),$("#statusbar").on("click","#reduce:not(.dis)",function(){return currentBet-=minimumBet,userMoney+=minimumBet,Game.sounds.bet(),Game.updateMoney(),!1}),$(controlsContainer).on("click","#hit:not(.dis)",function(){return Game.play.evaluate(),!1}),$(controlsContainer).on("click","#stand:not(.dis)",function(){return Game.play.finish(),!1}),$(controlsContainer).on("click","#restart",function(){return $(".card").remove(),$(controlsContainer).find("#hit, #stand").removeClass("dis"),$(controlsContainer).find("#restart").hide(),Game.startNew(),!1})}},Card=function(a,b){var c,d,e;e=a,d=b,c=1===e||2===e?"red":"black",this.getNumber=function(){return d},this.getSuit=function(){return e},this.getLetter=function(){return cardValue[d]},this.getValue=function(){return 0===d?11:d>=1&&10>d?d+1:10},this.getCard=function(a){var b;return"hidden"===a?b='<div class="card unknown"></div>':(b='<div class="card ',b+=suits[e]+" "+c+" card-"+cardValue[d],b+='" data-number="'+cardValue[d]+'">',b+='<div class="cover"></div><div class="deck"></div>'),b}},Hand=function(){var a,b,c;a=Game.deal(),b=Game.deal(),c=[a,b],this.getFirstCard=function(){return a},this.getSecondCard=function(){return b},this.getHand=function(){return c},this.score=function(){var a,b,d,e,f;for(d=0,a=0,e=0,f=c.length;f>e;e++)b=c[e],d+=c[e].getValue(),11===c[e].getValue()&&(a+=1);for(;a>0&&d>21;)d-=10,a--;return d},this.hitMe=function(){var a;return a=Game.deal(),c.push(a),a}},Bet=function(){var a=1200;this.getTotal=function(){return a},this.currentBet=function(){return currentBet},this.raise=function(){return total},this.reduce=function(){return total},this.win=function(){},this.lose=function(){}},$(document).ready(function(){Game.init()});