/**
 * JSblackjack 0.2.1 (https://github.com/vctrfrnndz/JSblackjack)
 * (c) 2012-2013 Victor Fernandez <victor@vctrfrnndz.com>
 * MIT Licensed.
 */
var Card,Game,Hand,UserException,barContainer,cardValue,controlsContainer,dealerContainer,dealerHand,hiddenCard,playerContainer,playerHand,suits;suits=["club","diamond","heart","spade"];cardValue=["a",2,3,4,5,6,7,8,9,10,"j","q","k"];playerContainer="#player";dealerContainer="#dealer";controlsContainer="#controls";barContainer="#msg";Game={deal:function(){var e,t;t=Math.floor(Math.random()*suits.length);e=Math.floor(Math.random()*cardValue.length);return new Card(t,e)},hitUser:function(e){var t,n,r;if(e==="player"){t=playerHand.hitMe();r=playerContainer}else{if(e!=="dealer")throw new UserException("hitUser function needs a role");t=dealerHand.hitMe();r=dealerContainer}n=t.getCard();$(n).appendTo(r).addClass("placed")},createHand:function(e){var t,n,r,i,s,o,u;n=new Hand;i=n.getHand();s=null;if(e==="player")s=playerContainer;else{if(e!=="dealer")throw new UserException("createHand function needs a role");s=dealerContainer}for(o=0,u=i.length;o<u;o++){t=i[o];r=i[o].getCard();if(e==="dealer"&&o===0){r=i[o].getCard("hidden");hiddenCard=i[o].getCard()}else r=i[o].getCard();$(s).append(r)}e==="player"&&Game.helpers.updateBar("Your hand is "+n.score()+", press Hit or Stand");return n},declareWinner:function(e,t){var n,r,i;i="You got "+e.score();n="dealer got "+dealerHand.score();r=i+", "+n;return e.score()===21?i+"! Blackjack!":e.score()>21?dealerHand.score()>21?r+". You tied!":r+". You lose!":dealerHand.score()>21?r+". You win!":e.score()>dealerHand.score()?r+". You win!":e.score()===dealerHand.score()?r+". You tied!":r+"! You lose!"},helpers:{dealAnimate:function(){$(".hand").each(function(){var e,t,n,r;e=0;n=$(this);t=n.find(".card");r=setInterval(function(){$(t[e]).addClass("placed");e===t.length&&clearInterval(this);e++},200)})},updateBar:function(e){$(barContainer).text(e)},stopControls:function(){$(controlsContainer).find("#hit, #stand").addClass("dis")}},play:{finish:function(){Game.helpers.stopControls();$(dealerContainer).find(".card:first-child").remove();$(hiddenCard).prependTo(dealerContainer).addClass("rolled");Game.helpers.updateBar(Game.declareWinner(playerHand,dealerHand));$(controlsContainer).find("#restart").show()},evaluate:function(){if(playerHand.score()>=21)Game.play.finish();else if(playerHand.score()<21){Game.hitUser("player");if(dealerHand.score()<17){Game.hitUser("dealer");dealerHand.score()>=21&&Game.play.finish()}playerHand.score()>=21||dealerHand.score()>=21?Game.play.finish():Game.helpers.updateBar("Your hand is "+playerHand.score()+", press Hit or Stand")}else Game.play.finish()}},startScreen:function(){$("#cover").css("visibility","visible");$("#logo").transition({x:"-50em"},0).transition({x:"0"},600,"in-out");$("#new-game").transition({x:"-50em"},0);$("#new-game").transition({x:"0"},600,"in-out");$("#logo").transition({perspective:"439px",rotateY:"0deg"}).transition({perspective:"439px",rotateY:"360deg"},600)},startNew:function(){playerHand=Game.createHand("player");dealerHand=Game.createHand("dealer");Game.helpers.dealAnimate();playerHand.score()>=21&&Game.play.finish()},init:function(){Game.startScreen();$("#new-game").on("click",function(){Game.startNew();$("#cover").hide();$("#game").css("visibility","visible");return!1});$(controlsContainer).on("click","#hit:not(.dis)",function(){Game.play.evaluate();return!1});$(controlsContainer).on("click","#stand:not(.dis)",function(){Game.play.finish();return!1});$(controlsContainer).on("click","#restart",function(){$(".card").remove();$(controlsContainer).find("#hit, #stand").removeClass("dis");$(controlsContainer).find("#restart").hide();Game.startNew();return!1})}};Card=function(e,t){var n,r,i;i=e;r=t;n=i===1||i===2?"red":"black";this.getNumber=function(){return r};this.getSuit=function(){return i};this.getLetter=function(){return cardValue[r]};this.getValue=function(){return r===1?11:r>1&&r<10?r:10};this.getCard=function(e){var t;if(e==="hidden")t='<div class="card unknown"></div>';else{t='<div class="card ';t+=suits[i]+" "+n+" card-"+cardValue[r];t+='" data-number="'+cardValue[r]+'">';t+='<div class="cover"></div><div class="deck"></div>'}return t}};Hand=function(){var e,t,n;e=Game.deal();t=Game.deal();n=[e,t];this.getFirstCard=function(){return e};this.getSecondCard=function(){return t};this.getHand=function(){return n};this.score=function(){var e,t,r,i,s;r=0;e=0;for(i=0,s=n.length;i<s;i++){t=n[i];r+=n[i].getValue();r+=1;n[i].getValue()===11&&(e+=1)}while(e>0&&r>21){r-=10;e--}return r};this.hitMe=function(){var e;e=Game.deal();n.push(e);return e}};UserException=function(e){this.message=e;this.name="UserException"};$(document).ready(function(){Game.init()});